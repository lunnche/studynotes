# **基于NARX神经网络的气象及空气质量常规-VOCs-紫外线能量耦合仿真O<sub>3</sub>浓度预测模型：利用双变量相关性、主成分分析探讨O<sub>3</sub>成因**



# 1.数学模型及控制论中相关理论

## 1.1 环境数学模型的分类

* 根据环境要素：河流、胡库、地下水水质模型、大气环境质量数学模型、生态系统数学模型、污染治理工程数学模型等
* 根据系统运行稳定性：稳态和动态模型
* 根据空间分布特征：一维、二维、三维模型
* 根据系统的机理研究推理方法：数值模型、统计模型

## 1.2 系统论、控制论中的相关概念

* 系统：两个以上元素，有机整体，执行特定功能、表现出特定的行为

* 子系统：系统中的子结构、元素

* 系统属性：

  > * 环境：系统以外的部分
  > * 边界：环境和系统之间的分界
  > * 结构：系统内各子系统之间的相互关系
  > * 输入：环境对系统的物质、能量、信息的作用
  > * 输出：系统对环境的反馈
  > * 功能：系统的达到目的性的能力
  > * 状态：系统在各时刻的功能行为的总体表现

* 因果性（causality）：在输入信号的激励下才产生了输出反馈响应

系统按因果性的分类：

* 因果系统（causal system）：牛顿经典力学中实际运行的系统，仅在输入信号作用下才有输出信号的系统
* 非因果系统（noncausal system）：输出反馈不仅与当前的输入，而且与将来的输入有关的系统
* 反因果系统（anticausal system）：输出仅与将来的输入有关的系统

## 1.3 系统论与控制论中的白灰黑箱概念

![image-20210707155419240](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210707155419240.png)

* 白箱：完全了解和理解内部运作机制和动力学的系统（适合数值模型建模）
* 黑箱：完全不了解……（尝试转换为灰箱建模）
* 灰箱：介于上述两者之间（适合统计模型建模）



# 2.人工神经网络基本原理及应用技术

* 人工神经网络的最大优势在于模式识别和预测

![image-20210707162313710](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210707162313710.png)



![image-20210712144848999](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210712144848999.png)

* 宇宙网络与人脑神经网络

  相似性：结构、增长扩展方式、生长动力。宇宙的网络与人脑网络结构极其相似，宇宙的历史与大脑回路的增长都以相似的方式扩展，它们都会协调相似节点，诸多连接点之间的关系

  系统驱动：子系统、反馈回路（Backfeed Loop）、动态平衡、自我组织

* 监测系统有着成吨的数据，但对管理部门却提供不了关键的支撑，如果故步自封，不拥抱新技术，那么我们大量的质量报告书，预报体系还会处于老八股的状态。和高校、环科院相比，我们还有很长的路要走。

* 早在20世纪40年代，西方一些神经解剖学家和数学家提出了神经元的数学算法模拟模型与结构（Simulation Model and Structure of Mathematical Algorithm），这就是最早的神经网络萌芽和雏形。

  进入21世纪，在现代电子学、数学和计算机科学的发展基础上，人工神经网络(Aritificial Neural Network)的设计思想开始成熟，它吸收了动物神经系统的基本结构和功能原理，并最大限度利用计算机系统的串行（Serial）与并行（Parallel）计算和存储优势，构建出人脑神经网络的数学模型。

## 2.1 线性与非线性

* 线性（linear）：量与量之间按比例、成直线的关系。数学上可理解为一阶导数为常数的函数。两个变量之间的关系是一次函数关系，图像是直线，这样的两个变量之间的关系就是“线性关系”：如：y = kx + b

* 非线性（non-linear），不按比例、不成直线的关系，一阶导数不为常数。两个变量之间的关系不是一次函数关系，图像不是直线，就是“非线性关系”。如：y = x^2

* 线性动力系统与非线性动力系统

  一般认为，随时间而变化的工程、物理、化学、生物、电磁、甚至天体、地质系统都可称为动力系统。如果这些变化是用非线性方程（常微分方程，偏微分方程，代数方程）描述，则称为非线性动力系统。非线性方程求解方法远没有线性方程那样完善，所以非线性动力学的发展较晚。

  ![image-20210712153836800](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210712153836800.png)

  一个非线性动力系统的例子，人类向外星发送信息，信息按二进制排列可显示有关人类的诸多信息。

  ![image-20210712154414797](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210712154414797.png)

  非线性动力系统例子，外星人发来的文字图片，用计算机视觉的卷积神经网络识别。

  ![image-20210712155559663](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210712155559663.png)

  简单的线性动力系统：

  左边：三个x加起来-1得到y1，三个数加起来+1得到y2。

  右边：x×2+1得到y  

  ![image-20210712155853097](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210712155853097.png)

  一下子看不出来，解方程可得一个二次方程，这是个典型的非线性动力系统

  ![image-20210712160006741](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210712160006741.png)

  ## 2.2 多项式--非线性动力学系统的数学描述方法

  ![image-20210712160223800](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210712160223800.png)

  * 一种简单的描述非线性动力系统的方法--多项式

    把x，y放入笛卡尔坐标系内得到七个点，把七个点用线段连起来得到黑色线，

    用最小二乘法做一元线性回归，得到一条直线，相关系数为0.3125很低（因为输入输出不是线性系统（比如分光光度法浓度值和吸光值就是线性系统））

  * 在excel里就可以做多项式回归：把点连起来，右键选添加趋势线-多项式-选5阶多项式（2阶以上都可以，如果选一阶多项式那么得到和上述最小二乘法结果一样的一条直线）

  * 6阶相较5阶而言称为过拟合，缺点是泛化推广能力差。

  * 在matlab中更容易做到，用polyfit函数计算多项式拟合曲线。

  多项式是一种简单的描述非线性动力学系统的方法

  ## 2.3 一个理想化的生物神经元模型和数学算法仿真模型

  ![image-20210713083442104](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210713083442104.png)

  神经元结构：

  * 树突：接收其他细胞传来的信号
  * 细胞核
  * 细胞体
  * 轴突丘
  * 轴突：传输信号到其他神经元细胞或组织
  * 郎飞氏结（Node of Ranvier）：引起神经递质的离子在不同的髓鞘、施万细胞间传递
  * 施万细胞（Schwann cell）：郎飞氏结之间的细胞，功能是产生髓鞘
  * 髓鞘（Myelin sheath）：增加信号的传输速度
  * 轴突末梢：连接下级神经元

  ![image-20210713084639632](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210713084639632.png)

  * 突触：上级神经元轴突末梢-（连接）-下级神经元树突 的地方
  * 膨大的地方叫突触柄，里面有突触囊泡（里边是神经递质）、线粒体
  * 下级神经元的树突和上级神经元的突触部位有一些受体，接收囊泡破裂后传出的神经递质

  ![image-20210713090051635](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210713090051635.png)

  上图为经过简化的人脑思维判断过程的生物神经元模型

  ![image-20210713091422001](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210713091422001.png)

  第一个神经元接收四种x信号并传给第二个神经元，第二个神经元叠加处理各种信号并传给第三个神经元，第三个神经元算出y，识别出能否通过交通灯，传递给运动神经

  ![image-20210713091639638](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210713091639638.png)

  左边是神经元的生物模型，右边是数学模型

  右边可见：每个输入都有个权重，神经元有个功能是加法器，b是阈值，并在输出前进行信号变换（称为激活函数或输出函数或传递函数）--输出

  ## 2.4 ANN的工作原理

  ![image-20210713092250231](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210713092250231.png)

  人工智能需要深厚数学功底，但如果只是应用，而非研究算法，并没有那么难。

  在组织、系统层面，巴甫洛夫发现了条件反射，赫布提出反射活动的持续与重复会导致神经元稳定性的持久提升，神经元联系被强化后就行成细胞回路，通过对神经元的刺激使得神经元突触的强度增强，这种学习方法称为赫布型学习。

  ## 2.5 神经网络的特点

  * 非线性
  * 非局限性
  * 分布式
  * 自适应
  * 自组织

  ## 2.6 ANN的工作原理

  ![image-20210713111631996](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210713111631996.png)

  阈值型激活函数

  ![image-20210713111703312](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210713111703312.png)

  分段线性激活函数  和  纯线性激活函数

  ![image-20210713112115584](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210713112115584.png)

  单极性S型激活函数 和 双极性S型激活函数

  ![image-20210714141124460](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210714141124460.png)

  一个简单的BP神经网络

  隐藏层可以一层也可多层，每层由多个神经元构成，每个神经元有自己独特的意志，每一层神经元s有一个共用的传递函数（激活函数）

  以b2为例，接收n个输入，每个输入有不同权值，输入和权值相乘后经相加，再加上自己的阈值，得到用于传递出去的值，该值经过传递函数（激活函数）变换后进行传递，再乘上连接权值。

  最后一层的值与样本相减，求出误差，如果误差超出理想范围，则反向传输误差，以使得每一个神经元重新调节其权值和阈值，这种调节是按步长和学习速率事先定义好的。

  ![image-20210714143012287](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210714143012287.png)

  若有m个输入，n个神经元，那么上图中就有m×n个曲面

  权值、阈值的组合也成为了网络参数，简称网参。

  神经网络的训练过程就是在权值、阈值、误差的曲面上搜索最小误差点

  最小误差点有很多，即神经网络的模型不是唯一的

  ![image-20210714144030385](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210714144030385.png)

  上图隐藏层传递函数默认用tansig

  输出层只有一个神经元，输出神经元的阈值是0，输出层传递函数是purelin，即y=x

  ## 2.7 神经网络的分类

  * 分类角度：网络性能、拓扑结构、学习方式（算法）、神经元的特征、连续突触性质、使用情景、是否有记忆和时间直接相关

  * 按是否有记忆和时间直接相关角度分类：

    > * 静态网络：无反馈记忆功能，输出与时间不直接相关，只依赖当前输入。主要用于因果关系比较单纯、明显的系统，已知样本的输出结果不构成预测样本的原因。常见的如：感知器网络、线性网络、RBF径向基网络、自组织网络、BP网络。
    > * 动态网络：具有输入延迟和输出反馈功能，具有动态特性（模型是动态微分方程），拥有记忆环节，能够对复杂的多输入/多输出系统进行逼近模拟，因此又称为反馈网络，已经广泛地用于模式识别、语音识别、图像处理、信号处理、系统控制、AUV自适应航向和机器人控制、故障检测、变形预报、最优化决策及求解非线性代数问题等方面。其中用的比较多的是时间序列问题，比如天气和环境质量预报。常见的有：离散型、连续型Hopfield网络、Elmean网络、Jordan网络、Boltzmann machine及变种、Echo State Network、Narnet（Nonlinear Autoregressive Time Series Network,非线性自动回归时间序列网络）、Narxnet（带外部输入的非线性自动回归时间序列网络）、Timedelaynet（Time-delay Neural Network，时间延迟神经网络）、Distdelaynet（Distributed Delay Neural Network）、LSTM（Long Short Term Memory，长短时记忆系统）等。

  ## 2.8 ANN的开发平台

  ![image-20210714155131343](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210714155131343.png)

# 3.NARX神经网络基本原理

![image-20210714155735066](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210714155735066.png)

narxnet（Nonlinear Autoregressive Time series Network with External Input）是动态时序网络最重要的解决方案之一，通过给定的历史时间序列来学习预测另一段时间的同样序列。反馈输入、另一段时间序列称为外部或外生（Exogenous）时间序列。

NARX网络A有一组输入Xt，并输出信息值Ht，右边为展开后的内部结构，循环回路允许信息从网络的每一个步骤展开为同一个网络的多个拷贝，每个拷贝把信息传递给后续步骤，步骤可以是时间序列，也可以是空间序列，从第二个序列开始，每个序列不仅要采纳自己的输入，而且要采纳上个序列的输出h作为另外的输入，而对于每个序列来讲，纳入自己的输入和上个序列的输出进行处理后不仅要传递给自己的输出，还要给下个序列的输入，这种逐个积累的机制，使得网络上每个序列的输入信息，输出信息互通有无，形成记忆，第一个序列的相关信息在最后一个序列中被利用。

## 3.1 NARX神经网络的建立

```
net=narxnet(inputDelays,feedbackDelays,hiddenSizes,feedbackMode,trainFcn)
```

其中：

* inputDelays：输入延迟行向量，可以是0（无延迟）或正整数（缺省=1:2)
* feedbackDelays：反馈输出延迟行向量，可以是0（无延迟）或正整数（缺省=1:2)
* hiddenSizes：含N层的各隐层神经元节点数量构成的行向量（缺省=10）
* feedbackMode：反馈模式，'open'为开环，或'closed'为闭环，（缺省='open'）
* trainFcn：前馈型训练函数（缺省='trainlm'）
* net：返回的NARX神经网络

## 3.2 闭环与开环

（1）闭环（closeloop）

动态网络被建立后，可以通过closeloop将开环网络转换为闭环形式，即将标记为开环的任意输出`NET.outputs{i}.feedbackMode = 'open'`转变为闭环。closeloop语法格式如下：

closeloop(NET)

这是通过将开环网络的输出（如输入索引等于`NET.outputs{i}.feedbackInput`的）相关联的输入替换为内部层权值连接来实现的。

（2）开环（openloop）

将闭环反馈神经网络转换为开环反馈神经网络，即将标记为闭环的任意输入（`NET.outputs{i}.feedbackMode = 'closed'`）转变为开环。语法格式如下：

openloop(NET)

通过将来自闭环网络的输出的层连接替换为来自新输入的权值，

`NET.outputs{i}.feedbackInput`设置为新输入的索引



通过开环、闭环移出[^?]延迟实现利用训练好的NARX网络进行趋势化仿真求解

## 3.3 NARX神经网络的仿真求解

```
Y2 = netc(Xs,Xi,Ai);    #netc为NARX网络的自定名
```

其中：

Y2：仿真输出 计算结果；

Xs：（被提取的）准备好的输入，为元胞数组；

Xi：（被提出的）初始输入延迟，为元胞数组；

Ai：（被提出的）初始层间延迟，为元胞数组

## 3.4 NARX神经网络的拓扑结构

![image-20210715084820499](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210715084820499.png)

# 4.环境科学中常用数据预处理技术

* 离群值处理 Outlier Processing

* 小波降噪 Wavelet Denoising

* 归一化 Normalization

* 降维 Dimension Reduction

  ​		Principal Component Analisys（主成分分析，最常用）

  ​		Missing Values Ratio（缺失值比率）

  ​		Low Variance Filter（低变量过滤器）

  ​		High Correlation Filter（高相关性过滤器）

  ​		Random Forests（随机森林）

  ​		Backward Feature Elimination（后向特征消除）

  ​		Forward Feature Construction（前向特征构建）

![image-20210715085257381](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210715085257381.png)

自动监测站标记的无效数据等需要剔除



主成分分析（Principal Component Analisys）

在描述一个事物的一系列指标中，有些指标的相关性较强，部分信息有所重叠。主成分分析（PCA）的方法为了将多个具有一定相关性的指标数据转变为少数几个不相关的综合指标，并对这些综合指标进行分类研究。这种分析方法可以降低指标维数，浓缩指标信息，简化复杂问题，从而使问题分析更加直观高效。在经济统计等领域中广泛应用。

环境监测指标是具有物理化学意义的，现有技术能力能够相对准确获取的对象的观测数据，但这并不意味监测指标能准确表征监测对象所有属性，比如污染物之间的协相关，耦合促进关系以现有监测指标无法穷尽描述。解决这一问题的有力方法就是PCA

PCA基本技术步骤：

> 1. 数据中心化：分别求各属性（各列）数据的平均值，各数据都减去对应的所在列的均值，得到新的中心化数据矩阵。
> 2. 求中心化数据的协方差（cov）矩阵：对角线上分别是各列自相关方差，非对角线上是协方差。协方差是衡量两个变量（任意2列）的相关性程度，数据绝对值越大则相关性越强，两者对彼此的影响越大，反之越小。
> 3. 求协方差的特征值和特征向量。
> 4. 将特征值按照从大到小的顺序排序，得到特征向量矩阵。
> 5. 将样本点投影到选取的特征向量上，就得到主成分矩阵，新的主成分按贡献率（方差大小）顺序按列排列。

![image-20210715102624894](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210715102624894.png)

PCA的SPSS实现

PCA的Matlab实现：

```
[coeff.score,latent,tsquared,explained]=pca(X);
```

x：原始数据，每列是一个变量，每行是一个样本

coeff：（协方差）转化矩阵

score：最后得出的主成分的值，每一列表示一个主成分（按第一主成分到第n主成分顺序排列在第1列到第n列）

latent：各主成分对应的特征向量，列向量

tsquare：Hotelling's T-squared统计量，列向量

explained：每一个主成分解释了对总方差贡献的百分比

# 5.ANN求解环境数学模型的技术路线

一个有入湖出湖河流的湖泊，营养物质浓度、水生动物种群结构及数量、浮游植物种群结构及密度、湖泊水质指标与入湖水质、水量、出湖水量、气候因素、地质因素的关系就可以建立一个灰箱模型来进行研究，基本目的为：通过以往历史数据资料来预测湖泊水质、水生动植物种群结构特征的变化趋势，基本步骤为：

> 1 首先定义系统，建立系统边界；
>
> ```
> 将湖泊多年的水位线标高所合围的湖底湖岸而形成的地理空间设为系统的边界
> ```
>
> 2 定义系统输入和输出指标；
>
> ```
> 输入：入湖和出湖河流的水质、水量等环境污染因素，光照、气温、降水等气候要素、湖泊的类型、湖底的积质？、地下水的补给、下泄、上漏等地质因素
> 输出：湖泊营养物质浓度、水生动物种群结构及数量、浮游植物种群及密度、湖泊不同点位的水质
> ```
>
> 3 收集多年历史数据；
>
> 4 数据整理及预处理；
>
> ```
> 数据矢量化、水生动物、浮游植物种群数量等文本数据建立量化指标体系、离群值剔除、降噪、降维、归一化（防止特征数量级差异带来的权重误导）
> ```
>
> 5 建立神经网络并使用已知数据集对网络进行训练；
>
> 6 评估网络可靠性并进一步优化网络；
>
> 7 求解；

![image-20210715110804500](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210715110804500.png)

验证样本也称为外侧样本

# 6.气象及空气质量常规-VOCs-紫外线能量耦合仿真O<sub>3</sub>浓度预测模型

## 6.1 数据条件

O~3~前体物主要为工业源、交通源、自然源（植物）排放的VOCs及NO~x~，高浓度的VOC~s~有利于O~3~的生成，而NO~x~却会减少O~3~的净产量。因此，VOC~s~/NO~x~的比值$\alpha$实际上决定了一个地区是VOC~s~敏感区还是NO~x~敏感区。以8为分界，当$\alpha$<8时，O~3~对VOC~s~更为敏感，当$\alpha$>8时则O~3~对NO~x~更为敏感。

目前我国已建成世界最大规模的空气质量监测网：已建成和在建中的各级空气质量自动监测站约6000个，包括常规站、背景站、VOC型站、超级站等。

常规站项目包括：

空气常规8项：

>  城市
>
> 日期时间
>
> SO~2~（$\mu$g/m^3^）及备注
>
> NO（$\mu$g/m^3^）及备注
>
> NO~2~（$\mu$g/m^3^）及备注
>
> NO~x~（$\mu$g/m^3^）及备注
>
> O~3~（$\mu$g/m^3^）及备注
>
> CO（mg/m^3^）及备注
>
> PM~10~（$\mu$g/m^3^）及备注
>
> PM~2.5~（$\mu$g/m^3^）
>
> 备注为数据特殊状态，在当前数据后以括号内加数据表示显示，与当前数据在同一字段

气象常规5项：

> 城市
>
> 站点
>
> 日期（年月日）
>
> 气压（hpa）及备注
>
> 气温（℃）及备注
>
> 湿度。。
>
> （deg）。。
>
> 风速（m/s）及备注



只考虑NOx等空气质量和气象常规因素，不考虑VOC~s~、紫外线、太阳辐射的O~3~预测在理论上存在重大缺陷。

为建立模型，收集到昆明某VOC站的气象及空气质量常规、VOC~s~，以及直线距离约3km处的国家气象基准站紫外线能量数据。

![image-20210716103141948](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210716103141948.png)

VOC~s~有上述类别

 收集到3km处国家气象基准站紫外线能量4项：

日期、时间2项外，还有：UVA、UVB、UVI、Volt 4项，单位分别为：W/m^2^、W/m^2^、无量纲、mv

![image-20210716103716349](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210716103716349.png)

上述为数据的时间范围

![image-20210716103909054](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210716103909054.png)

收集到的数据有很多问题，需要处理

## 6.2 数据结构

![image-20210716104320828](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210716104320828.png)

## 6.3 问题提出及建模规划

![image-20210716104656848](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210716104656848.png)

常规气象里把风速、风向扔掉？why？

## 6.4 样本规划

![image-20210716110207420](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210716110207420.png)

真正O~3~高浓度的样本只有5天共120个小时？ 

![image-20210716110613376](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210716110613376.png)

![image-20210716110808188](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210716110808188.png)

## 6.5 数据取舍和预处理

![image-20210716111020545](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210716111020545.png)

## 6.6 网络选型及超参选取

1 网络选型：

适合实现本案例建模需求的网络类型有BP网络和动态神经网络。动态神经网络的记忆功能与自然界甚至社会领域中的大多数系统特征吻合而被广泛应用，而其中的有反馈动态神经网络的输出不仅依赖于当前和历史的输入，也依赖于历史的输出，这与本案例中的各要素因子的相互作用关系相吻合，所以本案例采用典型的有反馈动态神经网络：NARX网络。

2 输入输出性质及延迟、超参选取

NARX网络的输入均为非反馈输入，气象3参数+空气常规7参数+UV4项+VOC~s~10项设为非反馈输入，O~3~为反馈输出；

上述因子并非同步实时作用于空气中O~3~浓度，而是在污染气象学、光化学、环境化学等动力学机制的共同作用下，一段时间后才能反馈形成当前的空气污染物浓度水平，被空气自动站监测到，因此输入-输出之间存在一定时间的延迟。

按照神经网络隐层设置基本原则，初步设置隐层结构后，要经过大步幅的粗调和小步幅微调，反复调试，得到最优的隐层结构：为NARX网络设置1-2个隐层，2层或单层神经元节点数量设置在10以内，训练函数使用缺省的trainlm函数。

## 6.7 主要技术路线和编程代码

主要技术路线如下：

1 读取紫外线能量数据集；对数据集进行预处理，紫外线能量数据缺失时段整行或多行数据线性插值，每小时内的60个分钟数据求取均值作为该时段小时数据。

2 将第一步得到的紫外线能量4项、获取的空气质量常规8项、气象常规3项、VOC~s~69项中文献公认对O~3~影响最大的前10项共24项指标的同期小时数据合并为1个数据集。

3 对数据集进行归一化、双变量相关性分析（BCA）、主成分分析（应排除第一行O~3~指标、对剩余24项进行PCA）。

4 用BCA前20项因子进行训练、模拟仿真预测、通过相对误差评价网络的可靠性。

5 用BCA前10项因子进行训练、模拟仿真预测、通过相对误差评价网络的可靠性。

6 用BCA前5项因子进行训练、模拟仿真预测、通过相对误差评价网络的可靠性。

7 用PCA前20项因子进行训练、模拟仿真预测、通过相对误差评价网络的可靠性。

8 用BCA前10项因子进行训练、模拟仿真预测、通过相对误差评价网络的可靠性。

9 用BCA前5项因子进行训练、模拟仿真预测、通过相对误差评价网络的可靠性。

10 用上述6次预测的相对误差来比较输入因子的选取的合理性。



10个子程序，共1235行代码。10个子程序为：

1 紫外线能量数据预处理子程序 p1_UVh_data.m

2 空气质量常规-紫外线能量-气象常规-VOC~s~数据合并处理子程序 p2_combine_aq8_UV4_mrtl3_voc10.m

3 双变量相关-主成分分析子程序 p3_BCA_PCA.m

4 双变量相关分析后取前20项因子预测主程序 p4_O3prd_20170123_20170815_s120h_BCA20.m

5 双变量相关分析后取前10项因子预测主程序 p5_O3prd_20170123_20170815_s120h_BCA10.m

6 双变量相关分析后取前5项因子预测主程序 p6_O3prd_20170123_20170815_s120h_BCA5.m

7 主成分分析后取前20项因子预测主程序 p7_O3prd_20170123_20170815_s120h_PCA20.m

8 主成分分析后取前10项因子预测主程序 p8_O3prd_20170123_20170815_s120h_PCA20.m

9 主成分分析后取前5项因子预测主程序 p9_O3prd_20170123_20170815_s120h_PCA20.m

10 10次训练预测准确性比较及最优训练预测模型模拟仿真预测结果图形 p10_... 画图程序



主要核心程序代码如下：

```   
net=narxnet(1:2,          1:2,           [7]);
        inputDelays feedbackDelays  hiddenSizes
%创建narx开环网络；经多次调试，S=[5-10]性能最佳，RE<6 延迟在1:5 - 1:7区间较佳;
```

```
net_lsa=removedelay(net);
%创建提前一步网络;
```

```
y2mc=net_lsa(Xs_lsa,          Xi_lsa,     Ai_lsa);
      被提取的准备好的输入 被提出的初始输入延迟  被提出的初始层延迟
%模拟仿真预测;
```

## 6.8 误差评价

![image-20210719145907526](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210719145907526.png)

![image-20210719150040741](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210719150040741.png)

## 6.9 结论和讨论

> 1 NARX网络建立的O~3~-VOC~s~10项-UV4项-气象3常规-空气7常规耦合模型能够比较准确地模拟预测O~3~浓度，在`net=narxnet(1:2,1:2,[7])`、24项因子取PCA构建的前5项主成分的网络结构和超级参数条件下，O~3~浓度模拟预测结果与世纪监测值的相对误差绝对值均值能稳定控制在6.96%以内。
>
> 2 虽然6种输入方案的预测相对误差区别不是非常显著，但误差总平均值是120样本×10次训练预测的结果，即1200组预测结果的平均值，可以代表各输入方案网络的总体性能，由误差总平均值可看出：按误差由小到大排序的输入方案为：PCA5、PCA10、PCA20、BCA10、BCA5、BCA20。总体上说：PCA优于BCA，这说明将多重共线性指标剔除后的少量主成分作为输入，对于网络的训练具有明显的帮助；前5项与前10项区别不大，前5、10优于前20。多种网络超级参数（隐层结构）组合 试验结果表明：在本案例样本前提下，1:2，1:2，[7]网络结构的性能是最优的。
>
> 3 以上2结论可以看出：网络的结构越简单、输入因子越少，网络性能越好， 这与提高网络泛化能力的基本原则是相符的。

提高网络泛化能力：1 网络要简单 2 优化网络的训练函数

trainbr（贝叶斯正则化）网络泛化能力明显比trainlm好

神经网络建立统计模型，并不是纯统计模型，在输入因子的选择中，要充分阅读学习文献，理解大气物理、大气化学反应原理，优化输入因子

若有条件，本模型可进一步优化扩展：除了时间序列外，可加入空间序列，尤其是上风向站点的气象空气质量紫外线等信息，并根据风向、风速的变化动态更新空间序列数据，这样建立的模型，其实是数值模型和统计模型的混合模型。

![image-20210719153150230](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210719153150230.png)









